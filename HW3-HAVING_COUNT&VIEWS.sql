DROP TABLE COPII;
DROP TABLE GRUPE;
DROP TABLE EDUCAT;

CREATE TABLE EDUCAT(
ID_EDUCAT NUMBER(2) PRIMARY KEY,
NUME VARCHAR2(200),
DATA_ANGAJARE DATE,
SALARIU NUMBER(7,2)
);

CREATE TABLE GRUPE(
ID_GRUPA NUMBER(2) PRIMARY KEY,
DENUMIRE VARCHAR2(15),
VARSTA_MIN NUMBER(1),
VARSTA_MAX NUMBER(1)
);

CREATE TABLE COPII(
ID_COPIL NUMBER(3) PRIMARY KEY,
NUME VARCHAR2(200),
DATA_NASTERE DATE,
ID_GRUPA NUMBER(2) REFERENCES GRUPE(ID_GRUPA),
ID_EDUCAT NUMBER(2) REFERENCES EDUCAT(ID_EDUCAT)
);

INSERT INTO EDUCAT VALUES(1,'MITURA GABRIELA',TO_DATE('10-08-2012','DD-MM-YYYY'), 2000);
INSERT INTO EDUCAT VALUES(2,'MITURA MIHAELA',TO_DATE('18-02-2011','DD-MM-YYYY'), 75000);
INSERT INTO EDUCAT VALUES(3,'MITURA DANIELA',TO_DATE('28-04-2014','DD-MM-YYYY'), 1200);


INSERT INTO GRUPE VALUES(1,'CIUPERCUTE',2,6);
INSERT INTO GRUPE VALUES(2,'GARGARITE',4,6);
INSERT INTO GRUPE VALUES(3,'MITITEI',3,6);

INSERT INTO COPII VALUES(1,'BALOIU RADU',TO_DATE('25-04-2013','DD-MM-YYYY'),1,1);
INSERT INTO COPII VALUES(2,'STEFANESCU MIHAI',TO_DATE('29-09-2013','DD-MM-YYYY'),1,1);
INSERT INTO COPII VALUES(3,'BARBU ANCA',TO_DATE('05-07-2010','DD-MM-YYYY'),2,2);
INSERT INTO COPII VALUES(4,'BALUTOIU DIANA',TO_DATE('21-01-2011','DD-MM-YYYY'),2,2);
INSERT INTO COPII VALUES(5,'STOICA EUGEN',TO_DATE('15-12-2012','DD-MM-YYYY'),3,3);
INSERT INTO COPII VALUES(6,'NADA GEORGE',TO_DATE('31-10-2013','DD-MM-YYYY'),3,3);
INSERT INTO COPII VALUES(7,'GHICA STEFAN',TO_DATE('23-04-2013','DD-MM-YYYY'),1,1);
INSERT INTO COPII VALUES(8,'FIONA SHREK',TO_DATE('19-05-2013','DD-MM-YYYY'),1,1);
INSERT INTO COPII VALUES(9,'CENUSAREASA',TO_DATE('30-05-2010','DD-MM-YYYY'),2,2);
INSERT INTO COPII VALUES(10,'SNOW WHITE',TO_DATE('08-06-2010','DD-MM-YYYY'),2,2);

--SELECT PRIN SUBCERERE
SELECT A.NUME, A.DATA_NASTERE FROM COPII A
	WHERE A.ID_GRUPA = (SELECT B.ID_GRUPA FROM GRUPE B
			WHERE B.DENUMIRE = 'CIUPERCUTE')
	AND
 	A.ID_EDUCAT = (SELECT C.ID_EDUCAT FROM EDUCAT C
			WHERE C.SALARIU = 1200);

--SELECT FOLOSIND JOIN ON 
SELECT A.NUME, A.DATA_NASTERE FROM 
	(COPII A JOIN GRUPE B ON A.ID_GRUPA = B.ID_GRUPA)
		JOIN EDUCAT C ON A.ID_EDUCAT = C.ID_EDUCAT 
		WHERE B.DENUMIRE = 'CIUPERCUTE'
			AND
			 C.SALARIU = 2000;

--SELECT EDUCATOAREA CU AL DOILEA SALARIU
SELECT A.NUME FROM EDUCAT A
WHERE 1 = (SELECT COUNT(B.SALARIU) FROM EDUCAT B
		WHERE A.SALARIU < B.SALARIU);

--NATURAL JOIN		
SELECT NUME FROM COPII NATURAL JOIN GRUPE
	WHERE DENUMIRE = 'CIUPERCUTE';

--GRUPA CU MAI MULT DE 3 COPII
SELECT A.DENUMIRE, COUNT(*) FROM GRUPE A, COPII B
WHERE A.ID_GRUPA = B.ID_GRUPA
GROUP BY DENUMIRE
HAVING COUNT (B.ID_COPIL) > 3;

-- Creaza view
CREATE OR REPLACE VIEW V_EDUCAT_HR AS (SELECT ID_EDUCAT, NUME, DATA_ANGAJARE FROM EDUCAT);

SELECT * FROM V_EDUCAT_HR;

-- VIEW PE JOIN DINTRE EDUCAT SI COPII
CREATE OR REPLACE VIEW V_JOIN_EDUCAT_COPII AS (SELECT A.NUME FROM COPII A JOIN EDUCAT B ON A.ID_EDUCAT = B.ID_EDUCAT WHERE A.ID_EDUCAT = 2);

SELECT * FROM V_JOIN_EDUCAT_COPII;

--SA SE SELECTEZE PT FIECARE COPIL NUMELE, NUMELE EDUCAT SI NUMELE GRUPEI DIN CARE FACE PARTE PENTRU TOTI COPII CARE AU EDUCATOARE PLATITE CU SALARII PESTE MEDIA GRADINITEI (CU VERIFICARE PE NULL)

SELECT * FROM V_EDUCAT_HR;

INSERT INTO V_EDUCAT_HR VALUES(4, 'Bichon', TO_DATE('14-09-2009', 'DD-MM-YYYY'));


SELECT A.NUME, B.NUME, C.DENUMIRE FROM COPII A
	JOIN EDUCAT B
		ON A.ID_EDUCAT = B.ID_EDUCAT
	JOIN GRUPE C
		ON A.ID_GRUPA = C.ID_GRUPA
	WHERE B.SALARIU > (SELECT AVG(NVL(SALARIU, 0)) FROM EDUCAT );
